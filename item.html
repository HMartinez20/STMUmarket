---
title: Item
---
<!DOCTYPE html>
<html>
  <header>
    {% include header.html %} <!-- Jekyll Liquid command -->
    {% include fire.html %}
  </header>
  <body>
    {% include navBar.html %}
	<div style="margin-left:45px; margin-right:45px">
		<div class="row">
			<div class="col-sm-2">
				<center id="otherImages"></center>
			</div>
			<div class="col-sm-5">
				<center id="mainImage"></center>
			</div>
			<div class="col-sm-5">
				<div id="postInfo" ></div>
				
				<div class="row">
				<button class = "btn btn-primary" id="contact" title="Seller Contact Information">
						Contact Seller
	 		 	</button>
				<div id="ownerActions"> </div>
				</div>

				<div class="card">
				<div class="card-header"> Description </div>
				<div class="card-body" id="itemDesc"> </div>
				</div>
			</div>
	  	</div> <!-- end of row  -->
		
		<div class="modal fade" id="editPosting">
			<div class="modal-dialog">
				<div class="modal-content">
					<!-- Modal Header -->
					<div class="modal-header">
						<h4 class="modal-title">Edit your Posting</h4>
						<button type="button" class="close" data-dismiss="modal">&times;</button>
					</div>
					<!-- Modal body -->
					<div class="modal-body">
						<form>
							<div class="form-group">
								<label for="inputTitle"> Title </label>
								<input type="text" class="form-control" id="inputTitle" placeholder="First Name">
							</div>
							<div class="form-group">
								<label for="inputDesc"> Description</label>
								<input type="text" class="form-control" id="inputDesc" placeholder="Last Name">
							</div>
							<button type="button" class="btn btn-primary" onclick="updatePost()"> Update </button>
						</form>
					</div>
				</div>
			</div>
		</div><!-- EDIT POSTING FORM ENDS -->
		
		<div class="modal fade" id="sell">
			<div class="modal-dialog">
				<div class="modal-content">
					<!-- Modal Header -->
					<div class="modal-header">
						<h4 class="modal-title">Update Posting Status</h4>
							<button type="button" class="close" data-dismiss="modal">&times;</button>
					</div>
					<!-- Modal body -->
					<div class="modal-body">
						<form>
							<div class="form-group">
								<label for="inputBuyer"> Please Enter username of buyer </label>
								<input type="text" class="form-control" id="inputBuyer" placeholder="username">
							</div>
							<button type="button" class="btn btn-primary" onclick="markSold()"> Mark as Sold </button>
						</form>
					</div>
				</div>
			</div>
		</div><!-- EDIT POSTING FORM ENDS -->
		
	  </div>
  </body>
   {% include footer.html %} 
</html>

<script>
console.log("8:54");
/* Code to get posting ID */
var postId = window.location.hash.substring(1)
console.log(postId);
/* redirect to home page if no variable was passed */
if (!(postId)){
	alert("Error Occurred, Redirecting to Home Page");
	window.location = "https://hmartinez20.github.io/STMUmarket/";
}	
	
/* Load posting Data */
db.collection("items").doc(window.postId).get().then(function(doc) {
	if (doc.exists) { 
		/* get posting data */
		var data = doc.data();
		var title = data.title;
		var price = data.price;
		var seller = data.seller;
		/* path to the specific seller's page */
		var sellerLink = "seller.html#" + data.sellerId; 
		
		/* Display title and price*/
		var postHead = document.createElement("div");
		postHead.innerHTML = "<h1>" + title + "</h1> <h3> Seller: <a href=" + sellerLink + ">" + seller +"</a></h3>";
		postHead.innerHTML+= "<h3>Price: $" + price + "</h3>";
		document.getElementById("postInfo").appendChild(postHead);
		
		db.collection("users").doc(data.sellerId).get().then(function(doc) {
			if(doc.exists){
				$('#contact').popover(
					{
					html:true,
					content: "To contact, send email to " + doc.data().email + " <br> and include 'STMUM Item: "+window.postId+ "' as the subject",
					trigger: "focus"
					}				
				);
			}
		});
		
		// Check to see if logged in user is owner of posting
		firebase.auth().onAuthStateChanged(function(user){
			if(user.uid == data.sellerId && data.sold =="no"){
				console.log("Owner is signed in");
				
				var buttons = document.createElement("div");
				buttons.innerHTML = "<button class='btn btn-primary' data-toggle='modal' data-target='#editPosting'> Edit </button>";
				buttons.innerHTML += "<button class='btn btn-primary' data-toggle='modal' data-target='#sell'> Mark as Sold </button>";
				
				document.getElementById("ownerActions").append(buttons);
			}
	
		});
		
		
		/* display description*/
		var desc = document.createElement("p");
		desc.innerHTML = data.description;
		document.getElementById("itemDesc").appendChild(desc);
		
		var imgSrc = "{{site.baseurl}}/Empty.jpg";
		if(doc.data().image1){ imgSrc = doc.data().image1; }
		/* display main image */
		var imgHTML = "<img style='width:100%; max-height:100%; border:2px solid #cecece;' src=" + imgSrc + "hspace='20'>"
		var cardImage = document.createElement("div");
		cardImage.innerHTML = imgHTML;
		document.getElementById("mainImage").append(cardImage);
		
		/* get and display other images */
		
		var img2 = "{{site.baseurl}}/Empty.jpg";
		if(doc.data().image2){ 
			var img2HTML = "<img style='max-width:60%; max-height:60%; border:2px solid #cecece;' src=" + doc.data().image2 + "hspace='20'><br><br><br>"
			var img2div = document.createElement("div");
			img2div.innerHTML = img2HTML;
			document.getElementById("otherImages").append(img2div);
		}
		
		var img3 = "{{site.baseurl}}/Empty.jpg";
		if(doc.data().image3){ 
			var img3HTML = "<img style='max-width:60%; max-height:60%; border:2px solid #cecece;' src=" + doc.data().image3 + "hspace='20'><br><br><br>"
			var img3div = document.createElement("div");
			img3div.innerHTML = img3HTML;
			document.getElementById("otherImages").append(img3div);
		}
		
		var img4 = "{{site.baseurl}}/Empty.jpg";
		if(doc.data().image4){ 
			var img4HTML = "<img style='max-width:60%; max-height:60%; border:2px solid #cecece;' src=" + doc.data().image4 + "hspace='20'><br><br><br>"
			var img4div = document.createElement("div");
			img4div.innerHTML = img4HTML;
			document.getElementById("otherImages").append(img4div);
		}
				 
		/* <IMG STYLE="position:absolute; TOP:350px; LEFT:300px; WIDTH:450px; HEIGHT:500px" src="" hspace="20"> */
		
		
	} else {
        	// doc doesn't exist
        	console.log("Requested document does not exist...");
   	}
}).catch(function(error) {
	console.log("Error getting document:", error);
});	

// update posting info
function updatePost(){
	var updateData = {};

	// Check if a value other than spaces was entered for title
	if ($.trim(document.getElementById("inputTitle").value).length > 0){
		console.log("Update Title");
		updateData["title"] = document.getElementById("inputTitle").value;
	}
	// Check if a value other than spaces was entered for description
	if ($.trim(document.getElementById("inputTitle").value).length > 0){
		console.log("Update Title");
		updateData["description"] = document.getElementById("inputTitle").value;
	}
	
	db.collection("items").doc(window.postId).update( // {
		/* title: document.getElementById("inputTitle").value ,
		 description: document.getElementById("inputDesc").value
	} */ updateData).then(function(){
		alert("Posting successfully updated");
	});
}

// mark listing as sold
function markSold(){
	var buyer = document.getElementById("inputBuyer").value;
	// Check that username is valid
	db.collection("users").where('username', '==', buyer).limit(1).get().then((snapshot) => {
		snapshot.docs.forEach(doc => {
			// if username is valid, mark as sold
			if(doc.exists){
			db.collection("items").doc(window.postId).update({
				sold: "yes",
				soldTo: buyer
			}).then(function() {
				alert("Great Job on the Sale!");
			});
		}
		else{
			alert("Invalid username");
		}
			
		})
	}).then(function(){
		console.log("SOLD!");
	});
	
	
}
	
</script>
